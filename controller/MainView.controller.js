sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/util/Storage","../core/eventQueue"],function(e,t,s,o){"use strict";return e.extend("ct.trec.cttrecapp.controller.MainView",{onInit:function(){this.setModel(new t({message:"",messageCount:0,ui:{cmdPanelExpanded:false},settings:{use_remote_odata:false}}),"view");if(this.getModel("view").getProperty("/settings/use_remote_odata")){const e=this.getOwnerComponent().getModel();e.metadataLoaded(true).then(()=>{e.read("/CheckInTypes",{success:e=>{this.getModel("ckt").setProperty("/types",e.results)}});e.read("/TypedCheckIns",{success:e=>{this.getModel("tci").setProperty("/items",e.results)}});o.register("complete",()=>{sap.m.MessageToast.show("success")});o.register("create-CheckInTypes",e=>new Promise((t,s)=>{this.getModel().create("/CheckInTypes",e,{success:()=>{t()},error:e=>{sap.m.MessageToast.show(`failed with msg: ${e.message}`);s()}})}));o.register("create-TypedCheckIns",e=>new Promise((t,s)=>{this.getModel().create("/TypedCheckIns",e,{success:()=>{t()},error:e=>{sap.m.MessageToast.show(`failed with msg: ${e.message}`);s()}})}))})}else{this._oStorage=new s(s.Type.local,"trec_all_data");const e=this._preProcessImport(JSON.parse(this._oStorage.get("stored_data")));if(e){this.getOwnerComponent().getModel("ckt").setData(e.CheckInTypes);this.getOwnerComponent().getModel("tci").setData(e.TypedCheckIns)}}},onNewCheckInType:function(){const e={ID:this.getModel("ckt").getProperty("/types").length,text:this.getModel("ckt").getProperty("/new/text")};if(this.getModel("view").getProperty("/settings/use_remote_odata")){o.emit({event:"create-CheckInTypes",data:e})}this.getModel("ckt").getProperty("/types").push(e);this.getModel("ckt").setProperty("/new/text","");this.getModel("ckt").refresh()},onTypedCheckIn:function(e){const t={ID:this.getModel("tci").getProperty("/items").length,value:e.getSource().getBindingContext("ckt").getObject().text,timestamp:new Date};if(this.getModel("view").getProperty("/settings/use_remote_odata")){o.emit({event:"create-TypedCheckIns",data:t})}this.getModel("tci").getProperty("/items").push(t);this.getModel("tci").refresh()},onPushAllData:function(){if(this.getModel("view").getProperty("/settings/use_remote_odata")){const e={name:"pushAllData",value:JSON.stringify({CheckInTypes:this.getModel("ckt").getData().types,TypedCheckIns:this.getModel("tci").getData().items})};this.getModel().create("/AllDatas",e,{success:()=>{sap.m.MessageToast.show("success")},error:e=>{sap.m.MessageToast.show(`failed with msg: ${e.message}`)}})}},onPullAllData:function(){if(this.getModel("view").getProperty("/settings/use_remote_odata")){this.getModel().read("/AllDatas",{success:e=>{const{CheckInTypes:t,TypedCheckIns:s}=JSON.parse(e.results[0].value);const o=this._preProcessImport({CheckInTypes:{types:t},TypedCheckIns:{items:s}});this.getModel("ckt").setData(o.CheckInTypes);this.getModel("tci").setData(o.TypedCheckIns)},error:e=>{sap.m.MessageToast.show(`failed with msg: ${e.message}`)}})}},onStoreAllData:function(){const e=JSON.stringify({CheckInTypes:this.getModel("ckt").getData(),TypedCheckIns:this.getModel("tci").getData()});this._oStorage.put("stored_data",e)},onClearAllData:function(){this._oStorage.remove("stored_data");sap.m.MessageToast.show("cleared")},onExportAllData:function(){const e={CheckInTypes:this.getModel("ckt").getData(),TypedCheckIns:this.getModel("tci").getData()};this.getModel("view").setProperty("/message",JSON.stringify(e,null,2))},onImportAllData:function(){const e=this._preProcessImport(JSON.parse(this.getModel("view").getProperty("/message")));this.getModel("ckt").setData(e.CheckInTypes);this.getModel("tci").setData(e.TypedCheckIns)},onCheckInItemPress:function(e){const t=e.getSource().getBindingContext("tci");if(!this._dialog){this._dialog=new sap.m.Dialog({title:"Comment {tci>ID}",content:[new sap.m.Input({value:"{tci>comment}"})],endButton:new sap.m.Button({text:"X",press:()=>{this._dialog.unbindElement();this._dialog.close()}})});this._dialog.addStyleClass("sapUiResponsivePadding--content sapUiResponsivePadding--header sapUiResponsivePadding--footer sapUiResponsivePadding--subHeader")}const s=this._dialog;s.setModel(this.getModel("tci"),"tci");s.bindElement({path:t.getPath(),model:"tci"});s.open()},onOpenMessage:function(){if(!this._msgDialog){this._msgDialog=new sap.m.Dialog({title:"Message {view>messageCount}",stretch:true,content:[new sap.m.TextArea({width:"100%",height:"100%",rows:16,value:"{view>message}"})],endButton:new sap.m.Button({text:"X",press:()=>{this._msgDialog.unbindElement();this._msgDialog.close()}})});this._msgDialog.addStyleClass("sapUiResponsivePadding--content sapUiResponsivePadding--header sapUiResponsivePadding--footer sapUiResponsivePadding--subHeader")}const e=this._msgDialog;e.setModel(this.getModel("view"),"view");e.bindElement({path:"/",model:"view"});e.open()},onCopyMessage:function(){this.byId("msgTextArea").getDomRef().firstChild.firstChild.select();navigator.clipboard.writeText(this.getModel().getProperty("/message")).then(()=>{sap.m.MessageToast.show("copied")},()=>{sap.m.MessageToast.show("copy failed")})},_preProcessImport:function(e){if(e?.TypedCheckIns?.items){e.TypedCheckIns.items.forEach(e=>{e.timestamp=new Date(e.timestamp)})}return e},formatEmptyText:function(e){return e?e:"-"}})});
//# sourceMappingURL=MainView.controller.js.map