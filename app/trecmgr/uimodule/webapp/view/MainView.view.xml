<mvc:View controllerName="ct.trec.cttrecapp.controller.MainView" xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true" xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <headerContent>
            <OverflowToolbar>
                <ToolbarSpacer></ToolbarSpacer>
                <Switch state="{view>/settings/use_remote_odata}"></Switch>
            </OverflowToolbar>
        </headerContent>
        <content>
            <Panel id="cmdPanel" expandable="true" expanded="{view>/ui/cmdPanelExpanded}">
                <headerToolbar>
                    <OverflowToolbar>
                        <ToolbarSpacer />
                        <Button icon="sap-icon://database" press="onStoreAllData" />
                        <Button icon="sap-icon://full-screen" press="onOpenMessage"
                            visible="{= !${view>/ui/cmdPanelExpanded}}" />
                        <HBox visible="{view>/ui/cmdPanelExpanded}">
                            <Button icon="sap-icon://copy" press="onCopyMessage" />
                            <Button text="Export" press="onExportAllData" />
                            <Button text="Import" press="onImportAllData" />
                            <Button icon="sap-icon://clear-all" press="onClearAllData" />
                            <Button text="Push" press="onPushAllData"
                                enabled="{view>/settings/use_remote_odata}" />
                            <Button text="Pull" press="onPullAllData"
                                enabled="{view>/settings/use_remote_odata}" />
                        </HBox>
                    </OverflowToolbar>
                </headerToolbar>
                <content>
                    <TextArea id="msgTextArea" value="{view>/message}" width="100%" height="12rem">
                    </TextArea>
                </content>
            </Panel>
            <Toolbar>
                <Label text="打卡" showColon="true" labelFor="checkInTypeInput"
                    width="2rem" class="sapUiTinyMarginEnd" />
                <Input value="{ckt>/new/text}" width="8rem" />
                <Button icon="sap-icon://add" press="onNewCheckInType" type="Transparent" />
                <Button icon="sap-icon://edit" press="onEditCheckInTypes" type="Transparent"
                    visible="{=!${view>/ui/checkInTypesEditable}}" />
                <Button icon="sap-icon://save" press="onEditCheckInTypes" type="Transparent"
                    visible="{view>/ui/checkInTypesEditable}" />
            </Toolbar>
            <List items="{ckt>/types}" visible="{view>/ui/checkInTypesEditable}" mode="Delete"
                delete="onDeleteCheckInType">
                <StandardListItem title="{ckt>text}" type="Detail" detailPress="onUpdateCheckInType" />
            </List>
            <Panel visible="{=!${view>/ui/checkInTypesEditable}}">
                <content>
                    <FlexBox items="{ckt>/types}" wrap="Wrap">
                        <Button text="{ckt>text}" press="onTypedCheckIn"
                            class="sapUiSmallMarginBegin" />
                    </FlexBox>
                    <Table
                        items="{ path: 'tci>/items',
                            sorter: {
                                path: 'timestamp',
                                descending: true
                            }}"
                        autoPopinMode="true" mode="Delete">
                        <headerToolbar>
                            <Toolbar>
                                <ToolbarSpacer />
                                <Button icon="sap-icon://edit" press="onEditCheckInItems"
                                    type="Transparent"
                                    visible="{=!${view>/ui/checkInItemsEditable}}" />
                                <Button icon="sap-icon://save" press="onEditCheckInItems"
                                    type="Transparent"
                                    visible="{view>/ui/checkInItemsEditable}" />
                            </Toolbar>
                        </headerToolbar>
                        <columns>
                            <Column width="8rem">
                                <Text text="动作" />
                            </Column>
                            <Column width="10rem" popinDisplay="WithoutHeader">
                                <Text text="时间" />
                            </Column>
                        </columns>
                        <items>
                            <ColumnListItem vAlign="Middle" type="Detail"
                                detailPress="onCheckInItemPress">
                                <cells>
                                    <ObjectIdentifier title="{tci>value}"
                                        text="{
                                        path:'tci>comment',
                                        formatter : '.formatEmptyText'
                                    }" />
                                    <DateTimePicker
                                        value="{
                                            path:'tci>timestamp',
                                            type:'sap.ui.model.type.DateTime',
                                            formatOptions: {
                                                'style': 'short'
                                            }
                                        }" />
                                </cells>
                            </ColumnListItem>
                        </items>
                    </Table>
                </content>
            </Panel>
        </content>
        <footer>
            <Bar></Bar>
        </footer>
    </Page>
</mvc:View>