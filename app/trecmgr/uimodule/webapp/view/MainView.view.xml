<mvc:View controllerName="ct.trec.trecmgr.controller.MainView" xmlns:mvc="sap.ui.core.mvc"
    displayBlock="true" xmlns="sap.m">
    <Page id="page" title="{i18n>title} ({view>/itemsCount})">
        <headerContent>
            <OverflowToolbar>
                <ToolbarSpacer></ToolbarSpacer>
                <Switch state="{view>/settings/use_remote_odata}"></Switch>
            </OverflowToolbar>
        </headerContent>
        <Panel expandable="true" expanded="{view>/ui/cmdPanelExpanded}">
            <headerToolbar>
                <OverflowToolbar>
                    <HBox alignItems="Center" visible="{= !${view>/ui/cmdPanelExpanded}}">
                        <Label text="" labelFor="checkInTypeInput" class="sapUiTinyMarginEnd" />
                        <Input value="{ckt>/new/text}" width="8rem" placeholder="打卡类型" />
                        <Button icon="sap-icon://add" press="onNewCheckInType" type="Transparent" />
                        <Button icon="sap-icon://edit" press="onEditCheckInTypes" type="Transparent"
                            visible="{=!${view>/ui/checkInTypesEditable}}" />
                        <Button icon="sap-icon://save" press="onEditCheckInTypes" type="Transparent"
                            visible="{view>/ui/checkInTypesEditable}" />
                    </HBox>
                    <ToolbarSpacer />
                    <Button icon="sap-icon://database" press="onStoreAllData" />
                    <Button icon="sap-icon://full-screen" press="onOpenMessage"
                        visible="{= !${view>/ui/cmdPanelExpanded}}" />
                    <HBox visible="{view>/ui/cmdPanelExpanded}">
                        <Button icon="sap-icon://copy" press="onCopyMessage" />
                        <Button text="Export" press="onExportAllData" />
                        <Button text="Import" press="onImportAllData" />
                        <Button icon="sap-icon://clear-all" press="onClearAllData" />
                        <Button text="Push" press="onPushAllData"
                            enabled="{view>/settings/use_remote_odata}" />
                        <Button text="Pull" press="onPullAllData"
                            enabled="{view>/settings/use_remote_odata}" />
                    </HBox>
                </OverflowToolbar>
            </headerToolbar>
            <content>
                <TextArea id="msgTextArea" value="{view>/message}" width="100%" height="12rem">
                </TextArea>
            </content>
        </Panel>
        <HBox alignItems="Center" visible="{view>/ui/cmdPanelExpanded}">
            <Label text="打卡类型" showColon="true" labelFor="checkInTypeInput"
                width="4rem" class="sapUiSmallMarginBegin sapUiTinyMarginEnd" />
            <Input value="{ckt>/new/text}" width="8rem" />
            <Button icon="sap-icon://add" press="onNewCheckInType" type="Transparent" />
            <Button icon="sap-icon://edit" press="onEditCheckInTypes" type="Transparent"
                visible="{=!${view>/ui/checkInTypesEditable}}" />
            <Button icon="sap-icon://save" press="onEditCheckInTypes" type="Transparent"
                visible="{view>/ui/checkInTypesEditable}" />
        </HBox>
        <List id="typesList" items="{ckt>/types}" visible="{view>/ui/checkInTypesEditable}"
            mode="Delete"
            headerText="({view>/typesCount})"
            delete="onDeleteCheckInType"
            updateFinished=".onTypesUpdateFinished">
            <StandardListItem title="{ckt>text}" type="Detail"
                detailPress="onUpdateCheckInType" />
        </List>
        <VBox visible="{=!${view>/ui/checkInTypesEditable}}">
            <FlexBox items="{ckt>/types}" wrap="Wrap">
                <Button text="{ckt>text}" press="onTypedCheckIn"
                    class="sapUiSmallMarginBegin" />
            </FlexBox>
            <Table id="itemsList"
                autoPopinMode="true" mode="Delete" delete="onDeleteCheckInItem"
                updateFinished=".onItemsUpdateFinished"
                items="{ 
                        path: 'tci>/items',
                        sorter: {
                            path: 'timestamp',
                            descending: true,
                            group: '.getItemsByDateGroup'
                        },
                        groupHeaderFactory: '.getItemsGroupByDateHeader'
                    }">
                <columns>
                    <Column width="8rem">
                        <Text text="动作" />
                    </Column>
                    <Column width="12rem" popinDisplay="WithoutHeader">
                        <Text text="时间" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem vAlign="Middle" type="Inactive">
                        <cells>
                            <ObjectIdentifier title="{tci>value}"
                                titleActive="true"
                                titlePress="onCheckInItemPress"
                                text="{
                                        path:'tci>comment',
                                        formatter : '.formatEmptyText'
                                    }" />
                            <DateTimePicker
                                value="{
                                        path:'tci>timestamp',
                                        type:'sap.ui.model.type.DateTime',
                                        formatOptions: {
                                            'style': 'short'
                                        }
                                    }" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </VBox>
        <footer>
            <Bar></Bar>
        </footer>
    </Page>
</mvc:View>